<app-header
  [activeType]="activeType()"
  [activeSort]="activeSort()"
  [selectedGenres]="selectedGenres()"
></app-header>

<div class="page-layout">
  <app-sidebar
    [initialQuery]="searchQuery()"
    [placeholder]="searchPlaceholder()"
    [selectedGenres]="selectedGenres()"
    [genres]="allGenres()"
    (searchChange)="onSearch($event)"
    (genreChange)="onGenreChange($event)"
  ></app-sidebar>

  <!--
    Основной контент.
    ИЗМЕНЕНИЕ: Убрали директиву appInfiniteScroll с тега main.
  -->
  <main class="content">
    @if (isLoading()) {
      <app-skeleton-list></app-skeleton-list>
    } @else if (error()) {
      <div class="app-state-indicator app-state-indicator--error">{{ error() }}</div>
    } @else {
      <app-movie-list
        [movies]="filteredMedia()"
        [emptyMessage]="emptyListMessage()"
        (movieClick)="onMediaSelect($event)"
      ></app-movie-list>

      @if (isLoadingMore()) {
        <div class="app-loading-more">
          <div class="spinner"></div>
        </div>
      }

      <!--
        ИЗМЕНЕНИЕ: Добавили невидимый "якорь" для Infinite Scroll.
        Когда этот элемент приближается к вьюпорту, срабатывает событие.
        Мы скрываем его (или не рендерим), если поиск активен (обычно в поиске пагинация
        может работать иначе, но в текущей логике блокируем, как было).
      -->
      @if (!searchQuery()) {
        <div
          class="infinite-scroll-trigger"
          appInfiniteScroll
          [threshold]="500"
          [disabled]="isLoading() || isLoadingMore() || !hasMorePages"
          (scrollEnd)="loadNextPage()"
        ></div>
      }
    }
  </main>
</div>
