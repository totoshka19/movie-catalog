<div class="movie-details-page__header">
  <div class="movie-details-page__breadcrumb-container">
    @if (mediaItem()) {
      <app-breadcrumb [items]="breadcrumbs()"></app-breadcrumb>
    }
  </div>
</div>

<div class="movie-details-page">
  @if (mediaItem(); as itemData) {
    <article class="movie-details-page__content">
      <div class="movie-details-page__poster">
        @if(itemData.primaryImage?.url) {
          <img
            [ngSrc]="itemData.primaryImage!.url | resizeImage:600"
            [alt]="'Постер ' + itemData.primaryTitle"
            fill
            priority
          >
        } @else {
          <div class="movie-details-page__poster-placeholder">Нет постера</div>
        }
      </div>
      <div class="movie-details-page__info">
        <h1 class="movie-details-page__title">
          {{ itemData.primaryTitle || itemData.originalTitle }}
          @if (itemData.startYear) {
            ({{ itemData.startYear }})
          }
        </h1>

        <div class="movie-details-page__meta">
          @if (itemData.rating && itemData.rating.aggregateRating > 0) {
            <span class="movie-details-page__rating">★ {{ itemData.rating.aggregateRating | number: '1.1-1' }}</span>
          }
          <div class="movie-details-page__genres">
            @for (genre of itemData.genres; track genre) {
              <span class="movie-details-page__genre-tag">{{ genre }}</span>
            }
          </div>
        </div>

        <div class="movie-details-page__extra-info">
          @if (itemData.runtimeSeconds) {
            <span>Продолжительность: {{ (itemData.runtimeSeconds / 60) | number:'1.0-0' }} мин.</span>
          }
        </div>

        <p class="movie-details-page__description">{{ itemData.plot || 'Описание отсутствует.' }}</p>

        <div class="movie-details-page__actions">
          @if (itemData.videosList?.length) {
            <button class="btn btn--primary" (click)="onPlayTrailer()">
              Смотреть трейлер
            </button>
          }
        </div>
      </div>
    </article>

    @if (itemData.creditsList?.length) {
      <section class="movie-details-page__section">
        <h2 class="movie-details-page__section-title">Актерский состав и создатели</h2>
        <div class="cast-list">
          @for (credit of itemData.creditsList; track $index) {
            <div class="cast-member">
              <div class="cast-member__photo">
                @if (credit.name?.primaryImage?.url) {
                  <img [src]="credit.name?.primaryImage?.url" [alt]="credit.name?.displayName" loading="lazy">
                } @else {
                  <div class="cast-member__photo-placeholder"></div>
                }
              </div>
              <p class="cast-member__name">{{ credit.name?.displayName }}</p>
              <p class="cast-member__character">{{ credit.characters?.join(', ') || credit.category }}</p>
            </div>
          }
        </div>
      </section>
    }

  } @else if (error()) {
    <div class="app-state-indicator app-state-indicator--error">{{ error() }}</div>
  } @else {
    <app-skeleton-details></app-skeleton-details>
  }
</div>

@if (selectedTrailerId(); as id) {
  <app-video-player
    [videoKey]="id"
    [title]="mediaItem()?.primaryTitle ?? 'Трейлер'"
    (close)="onCloseTrailer()"
  ></app-video-player>
}
